#!/usr/bin/env node
/*!
 * RedScript compiler
 * v 0.0.1
 * Copyright(c) 2013 Adam Brodzinski <adambrodzinski@gmail.com>
 * MIT Licensed
 */

/**
 * Dependencies
 */
var fs = require('fs')
  , cmd = require('../lib/cmdLine')
  , render = require('../lib/render');

var args =  process.argv.slice(2)
  , opts =  cmd.getOptions(args)
  , files = cmd.getFiles(args);


/**
 * If user passes watch flag, check every 100ms to see if the current
 * modification date is more than the previous check. If so, render file.
 */

if (opts.watchFiles && files.length) {
    console.log();
    console.log(">>> RedScript is watching for changes. Pres Ctrl-C to quit");
    files.forEach(function(file) {
        fs.watchFile(file, {interval: 100}, function (curr, prev) {
            if (curr.mtime > prev.mtime) {
                render(file);
            }
       });
    });

/**
 *  If no watch flag is passed, render each file
 */
} else if (files.length) {
    files.forEach(function(file) {
       render(file);
    });
}
// OCD induced blank line
console.log();


/*  debugz  */
this.debug = false;

if (this.debug) {
    console.log(""); console.log("options are "); console.log(opts);
    console.log("file list: "); console.log(files);
}
